<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://html2canvas.hertzen.com; script-src 'self' 'unsafe-inline' https://html2canvas.hertzen.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data:; connect-src 'none';">
    <title>Badminton Manager V9 (iPad Optimized)</title>
    <button id="btn-broadcast" class="secondary" onclick="toggleBroadcast()" style="margin-left: 10px;">üì° ‡πÄ‡∏£‡∏¥‡πà‡∏° Live</button>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <?!= include('style'); ?>
</head>
<body>

    <div id="main-view">
        <div id="courts-container" class="courts-area-grid"></div>

        <div id="next-match-panel" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h4 style="margin-top: 0; display: flex; align-items: center; gap: 10px; color: #ffffff !important; margin-bottom: 10px;">
                üì¢ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏á‡∏™‡∏ô‡∏≤‡∏° (Next Match)
                <span style="font-size: 0.8em; font-weight: normal; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 20px;">Auto Preview</span>
            </h4>
            <div id="next-match-list" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; justify-content: flex-start;">
                <div style="text-align:center; color: #ddd; font-style: italic;">... ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ...</div>
            </div>
        </div>

        <div class="bottom-data-section">
            <div class="control-sidebar-container pastel-panel panel-blue">
                
                <div class="sidebar-controls-wrapper">
                    <h3>üéÆ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</h3>
                    <div class="control-panel">
                        <div class="input-group">
                            <label>‡∏Ñ‡∏≠‡∏£‡πå‡∏ó:</label>
                            <button onclick="updateCourts(-1)">-</button>
                            <span id="court-count" style="font-weight:bold; width: 25px; text-align:center;">2</span>
                            <button onclick="updateCourts(1)">+</button>
                            <div style="flex:1"></div>
                            <button class="warning" onclick="resetStatsOnly()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                            <button class="danger" onclick="resetAll()">‡∏•‡πâ‡∏≤‡∏á</button>
                        </div>
                        <select id="game-rule" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ccc;">
                            <option value="normal">‡πÅ‡∏û‡πâ/‡∏ä‡∏ô‡∏∞ ‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏î (Normal)</option>
                            <option value="winner_stay">‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏ö 2 ‡πÄ‡∏Å‡∏°‡∏Ñ‡πà‡∏≠‡∏¢‡∏≠‡∏≠‡∏Å (Fixed Quota)</option>
                        </select>
                    </div>

                    <div class="control-panel">
                        <textarea id="new-players" placeholder="‡∏ß‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠... (1.‡πÅ‡∏õ‡∏á, 2.‡πÄ‡∏ß‡∏ü)"></textarea>
                        <div style="display:flex; gap:8px; margin-top:8px;">
                            <button class="success" style="flex:1;" onclick="addPlayers()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                            <button class="secondary" onclick="openBookingModal('pair')">‡∏Ñ‡∏π‡πà</button>
                            <button class="secondary" onclick="openBookingModal('match')">4</button>
                        </div>
                    </div>
                </div>

                <div class="sidebar-queue-wrapper">
                    <h4 style="margin: 10px 0;">‡∏£‡∏≠ (<span id="queue-count">0</span>)</h4>
                    <div style="flex:1; max-height:300px; overflow-y:auto; padding-right:2px;">
                        <ul id="player-queue" class="player-list"></ul>
                    </div>
                </div>

            </div>

            <div class="stats-column pastel-panel panel-green">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h3>
                    <select id="sort-select" onchange="updateDashboard()" style="padding:5px; border-radius:6px;">
                        <option value="games_desc">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏™‡∏∏‡∏î (Games ‚¨á)</option>
                        <option value="games_asc">‡πÄ‡∏•‡πà‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î (Games ‚¨Ü)</option>
                        <option value="wins_desc">‡∏ä‡∏ô‡∏∞‡πÄ‡∏¢‡∏≠‡∏∞‡∏™‡∏∏‡∏î (Wins ‚¨á)</option>
                    </select>
                </div>
                <div style="flex:1; max-height: 450px; overflow-y:auto; border-radius:8px;">
                    <table class="stats-table">
                        <thead>
                            <tr><th width="10%">#</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th width="15%">P</th><th width="15%">W</th><th width="15%">%</th></tr>
                        </thead>
                        <tbody id="stats-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="bottom-history-section pastel-panel panel-purple">
            <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            <div style="max-height: 250px; overflow-y:auto; border-radius:8px;">
                <table class="stats-table">
                    <thead><tr><th width="15%">‡πÄ‡∏ß‡∏•‡∏≤</th><th width="10%">‡∏ó‡∏µ‡πà</th><th>‡∏ó‡∏µ‡∏°‡∏ä‡∏ô‡∏∞ (Win)</th><th>‡∏ó‡∏µ‡∏°‡πÅ‡∏û‡πâ (Lose)</th><th width="10%">‡πÄ‡∏ß‡∏•‡∏≤</th></tr></thead>
                    <tbody id="match-log-body"><tr><td colspan="5" style="color:gray;">-</td></tr></tbody>
                </table>
            </div>
        </div>

        <div class="nav-bar">
            <button class="dark" style="width:100%; max-width:300px; padding:12px;" onclick="toggleView('overview')">üìÑ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Overview)</button>
        </div>
    </div>

    <div id="overview-view" class="hidden">
        <div class="pastel-panel panel-white" id="summary-capture-area">
            <h2 style="text-align:center; border-bottom:2px solid #2c3e50; padding-bottom:10px;">üè∏ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô</h2>
            <div style="display:flex; gap:20px; flex-wrap:wrap; margin-bottom:20px;">
                <div style="flex:2; min-width:300px;">
                    <h4>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ & ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h4>
                    <table class="stats-table">
                        <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>Check-in</th><th>‡πÄ‡∏•‡πà‡∏ô (Games)</th><th>‡∏ä‡∏ô‡∏∞ (Wins)</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ô‡πá‡∏ï (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                        <tbody id="overview-stats-body"></tbody>
                    </table>
                </div>
                <div style="flex:1; min-width:300px; background:#f9f9f9; padding:15px; border-radius:12px; border:1px solid #ddd;">
                    <h4>üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h4>
                    <div class="input-group"><label style="flex:1;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏ó:</label><input type="number" id="calc-court-count" value="2" style="width:60px; padding:5px;" onchange="updateCost()"></div>
                    <div class="input-group"><label style="flex:1;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏≠‡∏£‡πå‡∏ó/‡∏ä‡∏°.:</label><input type="number" id="calc-court-price" value="180" style="width:60px; padding:5px;" onchange="updateCost()"></div>
                    <div style="margin:5px 0;">
                        <button class="mini-btn secondary" onclick="toggleCustomHours()">üïí ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô?</button>
                        <div id="custom-hours-area" style="display:none; margin-top:5px; padding:5px; border:1px dashed #ccc;"></div>
                    </div>
                    <div class="input-group" id="std-hours-group"><label style="flex:1;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ä‡∏°. ‡∏£‡∏ß‡∏°:</label><input type="number" id="calc-hours" value="2" style="width:60px; padding:5px;" onchange="updateCost()"></div>
                    <hr>
                    <div class="input-group"><label style="flex:1;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏π‡∏Å (‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏î):</label><input type="number" id="calc-shuttle-price" value="750" style="width:60px; padding:5px;" onchange="updateCost()"></div>
                    <div class="input-group"><label style="flex:1;">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ (‡∏•‡∏π‡∏Å):</label><input type="number" id="calc-shuttle-used" value="0" style="width:60px; padding:5px;" onchange="updateCost()"></div>
                    <div class="cost-total">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="total-cost-display">0</span> ‡∏ö‡∏≤‡∏ó</div>
                    <small style="color:gray;">(‡∏´‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏≠‡∏á‡∏ô‡∏∞)</small>
                </div>
            </div>
            <div style="margin-top:20px;">
                <h4 style="color:#f9a825;">‚ö†Ô∏è ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏π‡πà‡∏ã‡πâ‡∏≥ (‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô)</h4>
                <table class="stats-table">
                    <thead><tr><th>‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th></tr></thead>
                    <tbody id="overview-repeat-body"><tr><td colspan="2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr></tbody>
                </table>
            </div>
        </div>
        <div class="nav-bar" style="gap:10px;">
            <button class="secondary" onclick="toggleView('main')">‚Ü© ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ô‡∏≤‡∏°</button>
            <button class="success" onclick="endSession()">üíæ ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (Save Image)</button>
        </div>
    </div>

    <div id="booking-modal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0;">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</h3>
            <div id="booking-inputs" style="max-height: 200px; overflow-y: auto; margin: 15px 0;"></div>
            <div class="modal-actions">
                <button class="secondary" onclick="closeModal('booking-modal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="success" onclick="confirmBooking()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="winner-modal" class="modal">
        <div class="modal-content" style="text-align:center;">
            <h2>üè∏ ‡∏à‡∏ö‡πÄ‡∏Å‡∏°!</h2>
            <div class="modal-actions" style="justify-content: center; flex-direction: column; gap: 10px;">
                <button class="success" style="background:#ffcdd2; color:#b71c1c; border:2px solid #ef5350; padding:12px;" onclick="resolveGame(0)">‡∏ä‡∏°‡∏û‡∏π (‡∏ö‡∏ô) ‡∏ä‡∏ô‡∏∞</button>
                <button class="success" style="background:#bbdefb; color:#0d47a1; border:2px solid #42a5f5; padding:12px;" onclick="resolveGame(1)">‡∏ü‡πâ‡∏≤ (‡∏•‡πà‡∏≤‡∏á) ‡∏ä‡∏ô‡∏∞</button>
                <hr style="width:100%; border-top:1px solid #eee; margin:5px 0;">
                <button class="warning" onclick="cancelStopGame()">‚Ü© ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (‡∏Å‡∏î‡∏ú‡∏¥‡∏î)</button>
            </div>
        </div>
    </div>

    <script>
      var APP_MODE = "<?= mode ?>";
      var APP_URL = "<?= appUrl ?>";
    </script>
    <?!= include('script'); ?>
</body>
</html>